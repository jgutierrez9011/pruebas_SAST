name: SonarCloud Scan

on:
  push:
    branches: [ main, master ]
  pull_request:

jobs:
  sonarcloud:
    name: SonarCloud
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install build tools
        run: sudo apt-get update && sudo apt-get install -y build-essential

      - name: (Optional) Build / ensure compile_commands.json
        run: |
          # Si ya tienes compile_commands.json en el repo, esta parte puede omitirse.
          if [ -f compile_commands.json ]; then
            echo "compile_commands.json already present"
          else
            # Compila el archivo para comprobar el build (no necesario para generar compile_commands.json)
            gcc -c buffer_overflow.c -o buffer_overflow.o -std=c11 -O0 -g
          fi

      - name: SonarCloud Scan
        uses: SonarSource/sonarcloud-github-action@master
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
